## Intro

Когда спустя некоторое время после безвременной кончины Стивера прекратил своё существование сайт **flibusta** (тогда казалось, что навсегда), это оказалось для меня неожиданно сильным ударом. На флибусте я привык искать нужные мне книги (а я запойный читатель с детских лет) и закрытие сайта, можно сказать, потрясло меня. Конечно, есть и другие сайты-библиотеки, да и флибуста вскоре ожила с помощью добрых людей, но осталось ощущение хрупкости бытия её и ей подобных. Пришла идея распределённой библиотеки, когда каждый её пользователь хранит у себя только интересные ему книги и делится ими по запросу коллеги; у каждого свои вкусы, "кто любит попа, кто попадью, а кто свиной хрящик", и таким образом всё множество книг хранится у его читателей. Не лишней была бы и анонимизация пользователей, в свете буйства правооблядателей. Я нашёл несколько распределённых систем хранения видео, но ни одной — книг, и эта идея так и пропала бы в нетях, не появись в нашем мире разнообразные Искусственные Разумы, в том числе и умеющие писать код. Не очень веря в успех, я попробовал поиграться с одним из них — Qwen3-Coder, на удивление, дело пошло, и вот я представляю наше творение.

Имя было дано — Turanga, в честь футурамского персонажа Туранги Лилы — командира Межпланетного Экспресса (отсылка к InterPlanetary File System) родом из ньюньюйоркского подземелья (ipfs и nostr тоже не запрещены, но как бы невидимы в повсеместном вебе). Книги обычно читают с ридеров, а те умеют обращаться за книгами к серверам opds, и программа является таким сервером для размещения на домашнем компьютере, для управления содержимым у неё сделан веб-интерфейс для доступа из любого браузера.

ipfs выбран в качестве системы хранения за свою скорость вхождения в сеть за несколько секунд, i2p и tor для этого требуются минуты и десятки минут. Про nostr я раньше и не знал, использовать его предложил AI, а sqlite — традиционная база данных для небольших проектов.

В отличие от той же **calibre**, где книга это некое логическое понятие, у которого может быть несколько файлов различных форматов, здесь всё проще — книгой считается файл; файлы разных форматов с одинаковым содержимым это разные книги.

У книги можно менять метаданные — автора, название, обложку, аннотацию, выходные данные; всё это сохраняется в базе данных и вспомогательных файлах, сам файл книги остаётся неизменным. Неизменность файла книги позволило ввести использование его хеша (выбран xxhash за скорость вычисления) для идентификации. Сделана система тегов, позволяющая произвольно выделять и группировать книги с их помощью; у каждой книги их может быть несколько. Есть флажок ограничения доступа с которым книга будет недоступна в opds. В opds также не передаются книги форматов pdf и djvu, только fb2, fb2.zip и epub.

Отличительная фишка программы — возможность запросить книгу через интернет. В этом случае запрос (фамилия автора, или часть названия/серии, или хеш) уходит на сервера nostr и ими передаётся другим турангам, те автоматически отсылают список имеющихся у них книг, удовлетворяющих запросу, и запросивший может скачать из них те, что ему интересны. Для идентификации на серверах nostr используются публичные ключи, которые генерируются при первом запуске программы. В любой момент можно сгенерировать новый, стерев приватный ключ из файла конфигурации и перезапустив программу, но это ведёт к потере бонусов, описанных ниже. Для ограничения трафика можно поставить ограничение запросов от одного пользователя, после превышения которого программа ему отвечать не будет в течение суток. Библиотеки, имеющие много книг и находящихся онлайн долгое время, могут принести своему хозяину своеобразный бонус — каждая скачанная у них книга увеличивает для него у скачавшего предел ограничения на единицу навсегда; т.е. если у А выставлен предел запросов 1, но он скачал у Б 5 книг, то программа А может ответить Б шесть раз в сутки.

С целью противодействия возможным деструктивным действиям есть возможность добавить злоумышленника, посылающего плохие книги, в "чёрный список", в этом случае ни книги, ни запросы от него не будут обрабатываться на этом компьютере.
